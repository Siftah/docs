---
layout: home
title: Specification
github_link: specification/index.html
---

<section class="page-intro">
    <div class="container">
        <h1 class="page-heading">{{ page.title }}</h1>
        <div class="page-tab-bar">
            <a class="tab" data-active-tab="services" href="#services">Services</a>
            <a class="tab" data-active-tab="structures" href="#structures">Structures</a>
            <a class="tab" data-active-tab="extensions" href="#extensions">Extensions</a>
        </div>
    </div>
</section>
<div class="container specification">
    <aside class="sidebar">
        <div class="sidebar-wrapper" id="navbar"></div>
    </aside>
    <section class="content">
        <div class="content-wrap" id="view"></div>
    </section>
</div>

<script src="{{ site.baseurl }}/specification/js/handlebars.js"></script>
<script src="{{ site.baseurl }}/specification/js/specification_browser.js"></script>
<script src="{{ site.baseurl }}/specification/js/jquery.bonsai.js"></script>

<script id="services-navigation-template" type="text/x-handlebars-template">
    {% raw %}
    <ul role="navigation">
        {{#each specification}}
        {{#if services.length}}
        <li class="level1"><span class="nav-header">{{module}}</span></li>
        {{#each services}}
        <li class="level-2"><a href="#{{../module}}.{{name}}">{{name}}</a></li>
        {{/each}}
        {{/if}}
        {{/each}}
    </ul>
    {% endraw %}
</script>

<script id="services-index-template" type="text/x-handlebars-template">
    {% raw %}
    <h2>Services</h2>
    <table>
        <thead>
        <tr>
            <th>Service</th>
            <th>Summary</th>
        </tr>
        </thead>
        <tbody>
        {{#each specification}}
        {{#each services}}
        <tr>
            <td><a href="#{{../module}}.{{name}}">{{../module}}.{{name}}</a></td>
            <td>{{summary}}</td>
        </tr>
        {{/each}}
        {{/each}}
        </tbody>
    </table>
    {% endraw %}
</script>

<script id="services-page-template" type="text/x-handlebars-template">
    {% raw %}
    <h2>{{ element.summary }} <small>{{module}}.{{element.name}}</small></h2>
    
    <p>{{ element.description }}</p>

    {{#if element.queries}}
    <h3>Queries</h3>
    {{#each element.queries }}
        {{> interaction type="query" }}
    {{/each}}
    {{/if}}

    {{#if element.commands }}
    <h3>Commands</h3>
    {{#each element.commands }}
        {{> interaction type="command" }}
    {{/each}}
    {{/if}}

    {{#if element.events }}
    <h3>Events</h3>
    {{#each element.events }}
        {{> interaction type="event" }}
    {{/each}}
    {{/if}}
    {% endraw %}
</script>

<script id="interaction-template" type="text/x-handlebars-template">
    {% raw %}
    <div style="background: #e1d2b4;margin-bottom: 20px;">
        <div style="padding: 10px"><b>{{name}}</b></div>
        <div class="" style="padding: 10px; border: 1px solid #e1d2b4;background: #f7f3eb;">
            <p>{{summary}}</p>
            <p>{{description}}</p>
            {{#if arguments.length }}
            <p style="font-weight: bold">Arguments</p>
            {{> type-tree properties=arguments className="arguments" }}
            {{/if}}
            {{#if returns }}
            <p style="font-weight: bold">Returns</p>
            {{ type returns }}
            {{/if}}
        </div>
    </div>
    {% endraw %}
</script>

<script id="structures-navigation-template" type="text/x-handlebars-template">
    {% raw %}
    <ul role="navigation">
        {{#each specification}}
        {{#if structures.length}}
        <li class="level1"><span class="nav-header">{{module}}</span></li>
        {{#each structures}}
        <li class="level-2"><a href="#{{../module}}.{{name}}">{{name}}</a></li>
        {{/each}}
        {{/if}}
        {{/each}}
    </ul>
    {% endraw %}
</script>

<script id="structures-index-template" type="text/x-handlebars-template">
    {% raw %}
    <h2>Structures</h2>
    <table>
        <thead>
        <tr>
            <th>Structure</th>
            <th>Summary</th>
        </tr>
        </thead>
        <tbody>
        {{#each specification}}
        {{#each structures}}
        <tr>
            <td><a href="#{{../module}}.{{name}}">{{../module}}.{{name}}</a></td>
            <td>{{summary}}</td>
        </tr>
        {{/each}}
        {{/each}}
        </tbody>
    </table>
    {% endraw %}
</script>

<script id="structures-page-template" type="text/x-handlebars-template">
    {% raw %}
    <h2>{{element.summary}} <small>{{module}}.{{element.name}}</small></h2>
    <p>{{element.description}}</p>
    <h3>Properties</h3>
    {{> type-tree properties=element.properties className="arguments" }}
    {% endraw %}
</script>

<script id="extensions-navigation-template" type="text/x-handlebars-template">
    {% raw %}
    <ul role="navigation">
        {{#each specification}}
        {{#if extensions.length}}
        <li class="level1"><span class="nav-header">{{module}}</span></li>
        {{#each extensions}}
        <li class="level-2"><a href="#{{../module}}.{{extends}}.{{name}}">{{name}}</a></li>
        {{/each}}
        {{/if}}
        {{/each}}
    </ul>
    {% endraw %}
</script>

<script id="extensions-index-template" type="text/x-handlebars-template">
    {% raw %}
    <h2>Extensions</h2>
    <table>
        <thead>
        <tr>
            <th>Extension</th>
            <th>Extends</th>
            <th>Summary</th>
        </tr>
        </thead>
        <tbody>
        {{#each specification}}
        {{#each extensions}}
        <tr>
            <td><a href="#{{../module}}.{{extends}}.{{name}}">{{name}}</a></td>
            <td>{{extends}}</td>
            <td>{{summary}}</td>
        </tr>
        {{/each}}
        {{/each}}
        </tbody>
    </table>
    {% endraw %}
</script>

<script id="extensions-page-template" type="text/x-handlebars-template">
    {% raw %}
    <h2>{{element.summary}} <small>{{module}}.{{element.extends}}.{{element.name}}</small></h2>
    <p>{{element.description}}</p>
    <h3>Properties</h3>
    {{> type-tree properties=element.properties className="arguments" }}
    {% endraw %}
</script>

<script id="arguments-template" type="text/x-handlebars-template">
    {% raw %}
    <ul class="{{className}}">
        {{#each properties}}
        <li>
            <div><span class="property-name">{{name}}</span> ({{type type}}) - {{summary}}</div>
            {{type-tree type}}
        </li>
        {{/each}}
    </ul>
    {% endraw %}
</script>

<script type="application/javascript">
    var genericMatcher = /^([a-z_]+)\[(.+)\]$/;
    
    Handlebars.registerHelper('type', function(type) {
        var typeRenderer = function(type) {
            if (genericMatcher.test(type)) {
                var matches = genericMatcher.exec(type);
                return matches[1] + '[' + typeRenderer(matches[2]) + ']';
            }

            if (type.indexOf('.') != -1) {
                var name = type.split('.').pop();
                return '<a href="#'+type+'" class="data-type">' + name + '</a>';
            }

            return type;
        };

        return new Handlebars.SafeString('<span class="data-type">' + typeRenderer(type) + '</span>');
    });
    Handlebars.registerHelper('type-tree', function(type) {
        var argumentsRenderer = function(type) {
            if (genericMatcher.test(type)) {
                var matches = genericMatcher.exec(type);
                return argumentsRenderer(matches[2]);
            }

            if (!SpecBrowser.index.hasOwnProperty(type)) {
                return null;
            }

            var element = SpecBrowser.index[type];

            if (element.type != 'structure') {
                return null;
            }

            var source   = $("#arguments-template").html();
            var template = Handlebars.compile(source);

            return new Handlebars.SafeString(template({properties: element.document.properties}));
        };
        
        return argumentsRenderer(type);
    });
    Handlebars.registerPartial('interaction', $("#interaction-template").html());
    Handlebars.registerPartial('type-tree', $("#arguments-template").html());
    
    SpecBrowser.fetch("{{ site.specificationurl }}");
    
    $(window).on('hashchange', function () {
        SpecBrowser.jump(window.location.hash.slice(1));
    });
</script>
